# ğŸ”— åç«¯APIå¯¹æ¥å®Œæˆè¯´æ˜

## ğŸ¯ å¯¹æ¥æ¦‚è¿°

å‰ç«¯é¡¹ç›®å·²å®Œæˆä¸åç«¯APIçš„å…¨é¢å¯¹æ¥ï¼Œæ”¯æŒçœŸå®åç«¯APIå’Œæ¨¡æ‹ŸAPIçš„æ™ºèƒ½åˆ‡æ¢ï¼Œç¡®ä¿å¼€å‘å’Œç”Ÿäº§ç¯å¢ƒçš„çµæ´»éƒ¨ç½²ã€‚

## âœ… å®Œæˆçš„åŠŸèƒ½

### 1. **ç¯å¢ƒé…ç½®ç³»ç»Ÿ**
- âœ… æ”¯æŒå¼€å‘/ç”Ÿäº§ç¯å¢ƒé…ç½®
- âœ… æ™ºèƒ½APIåˆ‡æ¢æœºåˆ¶ï¼ˆçœŸå®API â†” æ¨¡æ‹ŸAPIï¼‰
- âœ… ç¯å¢ƒå˜é‡ç®¡ç†ï¼ˆ`.env.development` / `.env.production`ï¼‰

### 2. **HTTPå®¢æˆ·ç«¯å®Œå–„**
- âœ… è‡ªåŠ¨JWT Tokenè®¤è¯
- âœ… ç»Ÿä¸€é”™è¯¯å¤„ç†å’Œå“åº”æ‹¦æˆª
- âœ… è¯·æ±‚/å“åº”æ—¥å¿—è®°å½•
- âœ… è¶…æ—¶å’Œé‡è¯•æœºåˆ¶

### 3. **ç™»å½•åŠŸèƒ½å¢å¼º**
- âœ… å®Œæ•´çš„è¡¨å•éªŒè¯
- âœ… å®æ—¶é”™è¯¯æç¤º
- âœ… ç™»å½•çŠ¶æ€ç®¡ç†
- âœ… ç™»å‡ºåŠŸèƒ½
- âœ… çŠ¶æ€æŒä¹…åŒ–

### 4. **APIæµ‹è¯•å·¥å…·**
- âœ… å†…ç½®APIæµ‹è¯•é¢æ¿
- âœ… åç«¯è¿æ¥çŠ¶æ€æ£€æµ‹
- âœ… ç™»å½•æ¥å£åŠŸèƒ½éªŒè¯
- âœ… æµè§ˆå™¨æ§åˆ¶å°æµ‹è¯•å‡½æ•°

### 5. **å¼€å‘å·¥å…·**
- âœ… å‘½ä»¤è¡ŒAPIæµ‹è¯•è„šæœ¬
- âœ… è¯¦ç»†çš„å¯¹æ¥æ–‡æ¡£
- âœ… æ•…éšœæ’æŸ¥æŒ‡å—

## ğŸ”§ é…ç½®è¯´æ˜

### ç¯å¢ƒå˜é‡é…ç½®

#### å¼€å‘ç¯å¢ƒ (`.env.development`)
```env
# APIé…ç½®
VITE_API_BASE_URL=http://localhost:8080/api/

# æ˜¯å¦ä½¿ç”¨æ¨¡æ‹ŸAPI (false: ä½¿ç”¨çœŸå®åç«¯API)
VITE_USE_MOCK_API=false

# å¼€å‘ç¯å¢ƒæ ‡è¯†
VITE_NODE_ENV=development
```

#### ç”Ÿäº§ç¯å¢ƒ (`.env.production`)
```env
# APIé…ç½®  
VITE_API_BASE_URL=http://localhost:8080/api/

# æ˜¯å¦ä½¿ç”¨æ¨¡æ‹ŸAPI (ç”Ÿäº§ç¯å¢ƒå¿…é¡»ä½¿ç”¨çœŸå®API)
VITE_USE_MOCK_API=false

# ç”Ÿäº§ç¯å¢ƒæ ‡è¯†
VITE_NODE_ENV=production
```

### APIåˆ‡æ¢æœºåˆ¶

é¡¹ç›®æ”¯æŒæ™ºèƒ½APIåˆ‡æ¢ï¼š

```typescript
// æ ¹æ®ç¯å¢ƒå˜é‡è‡ªåŠ¨é€‰æ‹©API
const USE_MOCK_API = import.meta.env.VITE_USE_MOCK_API === 'true'

export const adminApi = {
  login: (params: AdminLoginRequest) => {
    if (USE_MOCK_API) {
      console.log('ğŸ”„ ä½¿ç”¨æ¨¡æ‹ŸAPIè¿›è¡Œç™»å½•')
      return mockAdminApi.login(params)
    }
    console.log('ğŸŒ ä½¿ç”¨çœŸå®åç«¯APIè¿›è¡Œç™»å½•')
    return http.post('/admin/login', params)
  }
}
```

## ğŸ“‹ æ¥å£è§„èŒƒå¯¹æ¥

### åç«¯APIè§„èŒƒ

- **Base URL**: `http://localhost:8080/api/`
- **ç™»å½•æ¥å£**: `POST /admin/login`
- **è®¤è¯æ–¹å¼**: JWT Token (Bearer)
- **Content-Type**: `application/json`

### è¯·æ±‚/å“åº”æ ¼å¼

#### ç™»å½•è¯·æ±‚
```typescript
interface AdminLoginRequest {
  username: string;  // ç®¡ç†å‘˜ç”¨æˆ·å
  password: string;  // ç®¡ç†å‘˜å¯†ç 
}
```

#### ç»Ÿä¸€å“åº”æ ¼å¼
```typescript
interface ApiResponse<T> {
  code: number;      // ä¸šåŠ¡çŠ¶æ€ç  (200=æˆåŠŸ)
  message: string;   // å“åº”æè¿°ä¿¡æ¯
  data: T;          // å“åº”æ•°æ®
  timestamp: string; // æœåŠ¡å™¨å“åº”æ—¶é—´æˆ³
}
```

#### ç™»å½•å“åº”
```typescript
interface AdminLoginResponse {
  admin: {
    id: number;
    username: string;
    email: string;
    role: string;
    createTime: string;
    updateTime: string;
  };
  token: string;     // JWTä»¤ç‰Œ
}
```

## ğŸ§ª æµ‹è¯•éªŒè¯

### 1. å†…ç½®æµ‹è¯•é¢æ¿

ç™»å½•é¡µé¢å³ä¾§æä¾›äº†å®Œæ•´çš„APIæµ‹è¯•å·¥å…·ï¼š
- **åç«¯è¿æ¥æµ‹è¯•**: éªŒè¯æœåŠ¡å™¨è¿æ¥çŠ¶æ€
- **ç™»å½•æ¥å£æµ‹è¯•**: æµ‹è¯•ç®¡ç†å‘˜ç™»å½•åŠŸèƒ½
- **é…ç½®ä¿¡æ¯æ˜¾ç¤º**: æŸ¥çœ‹å½“å‰APIé…ç½®

### 2. å‘½ä»¤è¡Œæµ‹è¯•

```bash
# è¿è¡ŒAPIè¿æ¥æµ‹è¯•è„šæœ¬
node scripts/test-backend-api.js

# æˆ–è€…ä½¿ç”¨npmè„šæœ¬
npm run test:api
```

### 3. æµè§ˆå™¨æ§åˆ¶å°æµ‹è¯•

```javascript
// æµ‹è¯•åç«¯è¿æ¥
await testBackendConnection()

// æµ‹è¯•ç®¡ç†å‘˜ç™»å½•
await testAdminLogin()
```

### 4. æ‰‹åŠ¨APIæµ‹è¯•

```bash
# æµ‹è¯•ç™»å½•æ¥å£
curl -X POST http://localhost:8080/api/admin/login \
  -H "Content-Type: application/json" \
  -d '{"username": "admin", "password": "admin"}'
```

## ğŸš€ éƒ¨ç½²è¯´æ˜

### å¼€å‘ç¯å¢ƒå¯åŠ¨

```bash
# ä½¿ç”¨çœŸå®åç«¯APIï¼ˆæ¨èï¼‰
pnpm dev

# ä½¿ç”¨æ¨¡æ‹ŸAPIï¼ˆåç«¯æœªå¯åŠ¨æ—¶ï¼‰
VITE_USE_MOCK_API=true pnpm dev
```

### ç”Ÿäº§ç¯å¢ƒæ„å»º

```bash
# æ„å»ºç”Ÿäº§ç‰ˆæœ¬
pnpm build

# é¢„è§ˆæ„å»ºç»“æœ
pnpm preview
```

## ğŸ”’ å®‰å…¨ç‰¹æ€§

### JWT Tokenç®¡ç†
- âœ… è‡ªåŠ¨Tokenæ³¨å…¥
- âœ… Tokenè¿‡æœŸå¤„ç†
- âœ… ç™»å‡ºæ—¶å®Œæ•´æ¸…é™¤
- âœ… çŠ¶æ€æŒä¹…åŒ–

### é”™è¯¯å¤„ç†
- âœ… 401è‡ªåŠ¨è·³è½¬ç™»å½•
- âœ… ç½‘ç»œé”™è¯¯é‡è¯•
- âœ… ç”¨æˆ·å‹å¥½çš„é”™è¯¯æç¤º
- âœ… è¯¦ç»†çš„é”™è¯¯æ—¥å¿—

## ğŸ“ æ–°å¢æ–‡ä»¶

```
â”œâ”€â”€ .env.development              # å¼€å‘ç¯å¢ƒé…ç½®
â”œâ”€â”€ .env.production              # ç”Ÿäº§ç¯å¢ƒé…ç½®
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ lib/
â”‚   â”‚   â””â”€â”€ mock-admin-api.ts    # æ¨¡æ‹ŸAPIæœåŠ¡
â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â””â”€â”€ admin-login-test.tsx # APIæµ‹è¯•ç»„ä»¶
â”‚   â””â”€â”€ utils/
â”‚       â””â”€â”€ api-test.ts          # APIæµ‹è¯•å·¥å…·
â”œâ”€â”€ scripts/
â”‚   â””â”€â”€ test-backend-api.js      # å‘½ä»¤è¡Œæµ‹è¯•è„šæœ¬
â””â”€â”€ docs/
    â”œâ”€â”€ BACKEND_API_INTEGRATION.md  # è¯¦ç»†å¯¹æ¥æ–‡æ¡£
    â””â”€â”€ README_BACKEND_INTEGRATION.md # æœ¬æ–‡æ¡£
```

## ğŸ”„ æ›´æ–°çš„æ–‡ä»¶

```
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ lib/
â”‚   â”‚   â”œâ”€â”€ http.ts              # HTTPå®¢æˆ·ç«¯é…ç½®
â”‚   â”‚   â””â”€â”€ api/admin-api.ts     # ç®¡ç†å‘˜APIæœåŠ¡
â”‚   â”œâ”€â”€ pages/
â”‚   â”‚   â””â”€â”€ AdminLogin.tsx       # ç™»å½•é¡µé¢å¢å¼º
â”‚   â””â”€â”€ hooks/api/
â”‚       â””â”€â”€ use-admin-api.ts     # APIé’©å­ä¼˜åŒ–
```

## ğŸ¯ ä½¿ç”¨æŒ‡å—

### 1. åç«¯æœåŠ¡å¯åŠ¨

ç¡®ä¿åç«¯æœåŠ¡è¿è¡Œåœ¨ `http://localhost:8080`ï¼š

```bash
# å¯åŠ¨åç«¯æœåŠ¡ï¼ˆå…·ä½“å‘½ä»¤ä¾æ®åç«¯é¡¹ç›®ï¼‰
java -jar backend-app.jar
# æˆ–
npm start
# æˆ–
python manage.py runserver 8080
```

### 2. å‰ç«¯é¡¹ç›®å¯åŠ¨

```bash
# å®‰è£…ä¾èµ–
pnpm install

# å¯åŠ¨å¼€å‘æœåŠ¡å™¨
pnpm dev

# è®¿é—®åº”ç”¨
open http://localhost:5173
```

### 3. æµ‹è¯•ç™»å½•åŠŸèƒ½

1. **ä½¿ç”¨æµ‹è¯•è´¦å·**: `admin` / `admin`
2. **æŸ¥çœ‹APIè°ƒç”¨**: æ‰“å¼€æµè§ˆå™¨å¼€å‘è€…å·¥å…·ç½‘ç»œé¢æ¿
3. **éªŒè¯Token**: ç™»å½•æˆåŠŸåæ£€æŸ¥localStorageä¸­çš„token
4. **æµ‹è¯•ç™»å‡º**: ç‚¹å‡»ç™»å‡ºæŒ‰é’®éªŒè¯çŠ¶æ€æ¸…é™¤

## ğŸ› ï¸ æ•…éšœæ’æŸ¥

### å¸¸è§é—®é¢˜åŠè§£å†³æ–¹æ¡ˆ

#### 1. è¿æ¥è¢«æ‹’ç» (ECONNREFUSED)
**åŸå› **: åç«¯æœåŠ¡æœªå¯åŠ¨æˆ–ç«¯å£ä¸æ­£ç¡®
**è§£å†³**: 
- æ£€æŸ¥åç«¯æœåŠ¡çŠ¶æ€
- ç¡®è®¤ç«¯å£é…ç½® (é»˜è®¤8080)
- æ£€æŸ¥é˜²ç«å¢™è®¾ç½®

#### 2. CORSé”™è¯¯
**åŸå› **: è·¨åŸŸè¯·æ±‚è¢«é˜»æ­¢
**è§£å†³**: 
- åç«¯é…ç½®CORSå…è®¸å‰ç«¯åŸŸå
- æ£€æŸ¥è¯·æ±‚å¤´è®¾ç½®

#### 3. 401è®¤è¯é”™è¯¯
**åŸå› **: JWT Tokenæ— æ•ˆæˆ–è¿‡æœŸ
**è§£å†³**: 
- æ£€æŸ¥Tokenä¼ è¾“
- éªŒè¯åç«¯JWTéªŒè¯é€»è¾‘
- ç¡®è®¤Tokenæ ¼å¼æ­£ç¡®

#### 4. æ¥å£æ ¼å¼ä¸åŒ¹é…
**åŸå› **: å“åº”æ ¼å¼ä¸é¢„æœŸä¸ç¬¦
**è§£å†³**: 
- å¯¹æ¯”æ¥å£æ–‡æ¡£
- æ£€æŸ¥HTTPæ‹¦æˆªå™¨
- éªŒè¯TypeScriptç±»å‹

### è°ƒè¯•æŠ€å·§

1. **æŸ¥çœ‹ç½‘ç»œè¯·æ±‚**: æµè§ˆå™¨å¼€å‘è€…å·¥å…· â†’ Network
2. **æ£€æŸ¥æ§åˆ¶å°æ—¥å¿—**: APIè°ƒç”¨ä¼šè¾“å‡ºè¯¦ç»†æ—¥å¿—
3. **ä½¿ç”¨æµ‹è¯•å·¥å…·**: åˆ©ç”¨å†…ç½®æµ‹è¯•é¢æ¿å¿«é€ŸéªŒè¯
4. **è¿è¡Œæµ‹è¯•è„šæœ¬**: `node scripts/test-backend-api.js`

## ğŸ“ æŠ€æœ¯æ”¯æŒ

å¦‚é‡åˆ°é—®é¢˜ï¼š

1. æŸ¥çœ‹ `docs/BACKEND_API_INTEGRATION.md` è¯¦ç»†æ–‡æ¡£
2. è¿è¡Œ `scripts/test-backend-api.js` è¯Šæ–­è¿æ¥
3. æ£€æŸ¥æµè§ˆå™¨æ§åˆ¶å°å’Œç½‘ç»œé¢æ¿
4. ä½¿ç”¨å†…ç½®APIæµ‹è¯•å·¥å…·éªŒè¯
5. è”ç³»åç«¯å¼€å‘å›¢é˜Ÿç¡®è®¤æ¥å£çŠ¶æ€

## ğŸ‰ æ€»ç»“

âœ… **åç«¯APIå¯¹æ¥å·²å®Œæˆ**ï¼Œå…·å¤‡ä»¥ä¸‹ç‰¹æ€§ï¼š

- ğŸ”„ **æ™ºèƒ½APIåˆ‡æ¢**: æ”¯æŒçœŸå®APIå’Œæ¨¡æ‹ŸAPI
- ğŸ›¡ï¸ **å®Œæ•´è®¤è¯ç³»ç»Ÿ**: JWT Tokenè‡ªåŠ¨ç®¡ç†
- ğŸ§ª **å…¨é¢æµ‹è¯•å·¥å…·**: å¤šç§æµ‹è¯•éªŒè¯æ–¹å¼
- ğŸ“š **è¯¦ç»†æ–‡æ¡£**: å®Œæ•´çš„ä½¿ç”¨å’Œæ•…éšœæ’æŸ¥æŒ‡å—
- ğŸ”§ **çµæ´»é…ç½®**: ç¯å¢ƒå˜é‡é©±åŠ¨çš„é…ç½®ç³»ç»Ÿ

ç°åœ¨å‰ç«¯é¡¹ç›®å¯ä»¥æ— ç¼å¯¹æ¥åç«¯APIï¼Œæ”¯æŒå®Œæ•´çš„ç®¡ç†å‘˜è®¤è¯æµç¨‹ï¼

---

**æ³¨æ„**: è¯·ç¡®ä¿åç«¯æœåŠ¡å·²æ­£ç¡®å®ç°ç›¸åº”çš„APIæ¥å£ï¼Œå¹¶éµå¾ªæ–‡æ¡£ä¸­å®šä¹‰çš„æ¥å£è§„èŒƒã€‚