# 管理员封禁用户接口文档

## 1. 封禁用户账户

### 接口信息
- **接口路径**: `/api/admin/users/ban`
- **请求方法**: `POST`
- **接口描述**: 管理员封禁用户账户（永久封禁）
- **需要认证**: 是（管理员权限）

### 请求参数
```json
{
    "userId": 123,
    "banReason": "违反用户协议"
}
```

#### 参数说明
| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| userId | Long | 是 | 要封禁的用户ID |
| banReason | String | 是 | 封禁原因，长度1-500字符 |

### 响应格式
#### 成功响应
```json
{
    "code": 200,
    "message": "success",
    "data": "用户封禁成功"
}
```

#### 错误响应
```json
{
    "code": 400,
    "message": "用户ID不能为空",
    "data": null
}
```

```json
{
    "code": 404,
    "message": "用户不存在",
    "data": null
}
```

```json
{
    "code": 409,
    "message": "用户已被封禁",
    "data": null
}
```

### 测试用例
```bash
# 封禁用户
curl -X POST http://localhost:8080/api/admin/users/ban \
  -H "Content-Type: application/json" \
  -d '{
    "userId": 2,
    "banReason": "恶意使用服务"
  }'
```

---

## 2. 解封用户账户

### 接口信息
- **接口路径**: `/api/admin/users/unban`
- **请求方法**: `POST`
- **接口描述**: 管理员解封用户账户
- **需要认证**: 是（管理员权限）

### 请求参数
```json
{
    "userId": 123
}
```

#### 参数说明
| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| userId | Long | 是 | 要解封的用户ID |

### 响应格式
#### 成功响应
```json
{
    "code": 200,
    "message": "success",
    "data": "用户解封成功"
}
```

#### 错误响应
```json
{
    "code": 400,
    "message": "用户ID不能为空",
    "data": null
}
```

```json
{
    "code": 404,
    "message": "用户不存在",
    "data": null
}
```

```json
{
    "code": 409,
    "message": "用户未被封禁",
    "data": null
}
```

### 测试用例
```bash
# 解封用户
curl -X POST http://localhost:8080/api/admin/users/unban \
  -H "Content-Type: application/json" \
  -d '{
    "userId": 2
  }'
```

---

## 3. 检查用户封禁状态

### 接口信息
- **接口路径**: `/api/admin/users/{userId}/ban-status`
- **请求方法**: `GET`
- **接口描述**: 检查用户是否被封禁
- **需要认证**: 是（管理员权限）

### 请求参数
| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| userId | Long | 是 | 用户ID（路径参数） |

### 响应格式
#### 成功响应
```json
{
    "code": 200,
    "message": "success",
    "data": true
}
```

### 测试用例
```bash
# 检查用户封禁状态
curl -X GET http://localhost:8080/api/admin/users/2/ban-status
```

---

## 4. 获取用户封禁详情

### 接口信息
- **接口路径**: `/api/admin/users/{userId}/ban-details`
- **请求方法**: `GET`
- **接口描述**: 获取用户封禁详细信息
- **需要认证**: 是（管理员权限）

### 请求参数
| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| userId | Long | 是 | 用户ID（路径参数） |

### 响应格式
#### 成功响应
```json
{
    "code": 200,
    "message": "success",
    "data": {
        "id": 2,
        "username": "testuser",
        "email": "test@example.com",
        "status": "BANNED",
        "isBanned": true,
        "banReason": "恶意使用服务",
        "bannedBy": 1,
        "banTime": "2025-08-27T10:30:00"
    }
}
```

#### 错误响应
```json
{
    "code": 404,
    "message": "用户不存在",
    "data": null
}
```

### 测试用例
```bash
# 获取用户封禁详情
curl -X GET http://localhost:8080/api/admin/users/2/ban-details
```

---

## 业务规则

### 封禁规则
1. **永久封禁**: 系统只支持永久封禁，不支持临时封禁
2. **封禁原因**: 必须提供封禁原因，长度限制1-500字符
3. **重复封禁**: 已被封禁的用户不能重复封禁
4. **管理员记录**: 系统会记录执行封禁操作的管理员ID

### 解封规则
1. **解封条件**: 只有被封禁的用户才能被解封
2. **状态重置**: 解封后用户状态恢复为ACTIVE
3. **记录清理**: 解封时会清空封禁相关字段

### 登录限制
1. **封禁检查**: 用户登录时会检查封禁状态
2. **登录拒绝**: 被封禁用户无法登录，返回"账户已被封禁，无法登录"错误
3. **实时生效**: 封禁状态立即生效，无需重启服务

## 数据库变更

### 用户表新增字段
```sql
ALTER TABLE user 
ADD COLUMN is_banned BOOLEAN DEFAULT FALSE COMMENT '是否被封禁',
ADD COLUMN ban_reason VARCHAR(500) DEFAULT NULL COMMENT '封禁原因',
ADD COLUMN banned_by BIGINT DEFAULT NULL COMMENT '执行封禁的管理员ID',
ADD COLUMN ban_time TIMESTAMP DEFAULT NULL COMMENT '封禁时间';
```

## 注意事项

1. **权限控制**: 所有封禁相关接口都需要管理员权限
2. **日志记录**: 所有封禁操作都会记录详细日志
3. **参数验证**: 严格验证请求参数，防止恶意操作
4. **错误处理**: 提供详细的错误信息，便于问题排查
5. **数据一致性**: 封禁操作会同时更新用户状态和封禁字段