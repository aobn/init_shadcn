# 管理员登录接口文档

## 基本信息

- **接口标识**: `ADMIN_LOGIN`
- **请求路径**: `POST /api/admin/login`
- **接口描述**: 管理员通过用户名和密码登录系统，获取JWT令牌
- **认证要求**: 无需认证（公开接口）
- **适用业务单元**: 管理员认证模块

## 请求参数

### 请求头
```
Content-Type: application/json
```

### 请求体
```typescript
interface AdminLoginRequest {
  username: string;     // 管理员用户名，必填
  password: string;     // 管理员密码，必填
}
```

### 参数验证规则
```json
{
  "username": {
    "required": true,
    "type": "string",
    "message": "用户名不能为空"
  },
  "password": {
    "required": true,
    "type": "string",
    "message": "密码不能为空"
  }
}
```

## 响应示例

### 成功响应（状态码 200）
```json
{
  "code": 200,
  "message": "操作成功",
  "data": {
    "admin": {
      "id": 1,
      "username": "admin",
      "email": "admin@example.com",
      "role": "ADMIN",
      "createTime": "2025-08-11T10:30:00",
      "updateTime": "2025-08-11T10:30:00"
    },
    "token": "eyJhbGciOiJIUzI1NiJ9.eyJyb2xlIjoiQURNSU4iLCJlbWFpbCI6ImFkbWluQGV4YW1wbGUuY29tIiwic3ViIjoiMSIsImlhdCI6MTcyNTY2MTA2NiwiZXhwIjoxNzI1NzQ3NDY2fQ.1O7dWONu5O0NmyabvAawP5FSRrY319f8ll6ryK_mINc"
  },
  "timestamp": "2025-09-11T23:00:00"
}
```

### 失败响应

#### 1. 参数验证失败（400）
```json
{
  "code": 400,
  "message": "用户名不能为空",
  "data": null,
  "timestamp": "2025-09-11T23:00:00"
}
```

#### 2. 用户名或密码错误（401）
```json
{
  "code": 401,
  "message": "用户名或密码错误",
  "data": null,
  "timestamp": "2025-09-11T23:00:00"
}
```

#### 3. 服务器内部错误（500）
```json
{
  "code": 500,
  "message": "服务器内部错误详细信息",
  "data": null,
  "timestamp": "2025-09-11T23:00:00"
}
```

## 业务逻辑说明

### 登录流程
1. **参数验证**: 验证用户名和密码是否为空
2. **用户查询**: 根据用户名查询管理员信息
3. **密码验证**: 使用BCrypt验证密码是否正确
4. **令牌生成**: 生成包含管理员ID、邮箱和角色的JWT令牌
5. **响应构建**: 构建包含管理员信息和令牌的响应对象
6. **返回结果**: 返回登录成功或失败的响应

### 安全机制
- **密码加密**: 数据库中存储BCrypt加密的密码
- **JWT令牌**: 生成包含管理员身份信息的JWT令牌
- **密码隐藏**: 响应中不包含密码信息
- **错误统一**: 用户名不存在和密码错误返回相同错误信息，防止用户名枚举

### JWT令牌信息
生成的JWT令牌包含以下信息：
- **sub**: 管理员ID
- **email**: 管理员邮箱
- **role**: 管理员角色（ADMIN）
- **iat**: 令牌签发时间
- **exp**: 令牌过期时间（24小时后）

## 调试说明

### 测试用例

#### 测试用例1：成功登录
```bash
curl -X POST http://localhost:8080/api/admin/login \
  -H "Content-Type: application/json" \
  -d '{
    "username": "admin",
    "password": "admin"
  }'
```
**预期响应**: code=200，data包含管理员信息和JWT令牌

#### 测试用例2：用户名为空
```bash
curl -X POST http://localhost:8080/api/admin/login \
  -H "Content-Type: application/json" \
  -d '{
    "username": "",
    "password": "admin"
  }'
```
**预期响应**: code=400，message="用户名不能为空"

#### 测试用例3：密码为空
```bash
curl -X POST http://localhost:8080/api/admin/login \
  -H "Content-Type: application/json" \
  -d '{
    "username": "admin",
    "password": ""
  }'
```
**预期响应**: code=400，message="密码不能为空"

#### 测试用例4：用户名不存在
```bash
curl -X POST http://localhost:8080/api/admin/login \
  -H "Content-Type: application/json" \
  -d '{
    "username": "nonexistent",
    "password": "admin"
  }'
```
**预期响应**: code=401，message="用户名或密码错误"

#### 测试用例5：密码错误
```bash
curl -X POST http://localhost:8080/api/admin/login \
  -H "Content-Type: application/json" \
  -d '{
    "username": "admin",
    "password": "wrongpassword"
  }'
```
**预期响应**: code=401，message="用户名或密码错误"

#### 测试用例6：缺少Content-Type头
```bash
curl -X POST http://localhost:8080/api/admin/login \
  -d '{
    "username": "admin",
    "password": "admin"
  }'
```
**预期响应**: 可能出现解析错误

## 使用JWT令牌

登录成功后，可以使用返回的JWT令牌访问需要管理员权限的接口：

```bash
# 使用令牌访问受保护的管理员接口
curl -X GET http://localhost:8080/api/admin/1 \
  -H "Authorization: Bearer eyJhbGciOiJIUzI1NiJ9..."
```

## 注意事项

1. **令牌有效期**: JWT令牌有效期为24小时，过期后需要重新登录
2. **密码安全**: 管理员密码使用BCrypt加密存储，安全性较高
3. **错误处理**: 统一的错误响应格式，便于前端处理
4. **日志记录**: 系统会记录登录成功和失败的日志，便于安全审计
5. **角色权限**: 登录成功后，可以根据返回的role字段进行权限控制

## 相关接口

- [管理员注册接口](./管理员注册接口.md)
- [获取管理员信息接口](./获取管理员信息接口.md)
- [更新管理员信息接口](./更新管理员信息接口.md)
- [JWT认证过滤器](./JWT认证过滤器.md)

## 数据库依赖

该接口依赖以下数据库表：
- **admin表**: 存储管理员基本信息

```sql
CREATE TABLE `admin` (
  `id` bigint NOT NULL AUTO_INCREMENT,
  `username` varchar(50) NOT NULL,
  `password` varchar(100) NOT NULL,
  `email` varchar(100) NOT NULL,
  `role` varchar(20) NOT NULL DEFAULT 'ADMIN',
  `create_time` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,
  `update_time` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`),
  UNIQUE KEY `username` (`username`),
  UNIQUE KEY `email` (`email`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;
```

## 测试数据

根据测试数据文档，可以使用以下测试账号：
- **用户名**: admin
- **密码**: admin