# 管理员登录功能使用指南

## 功能概述

已成功对接管理员登录接口，实现了完整的管理员认证系统，包括登录、状态管理、权限验证和自动跳转等功能。

## 访问路径

### 1. 管理员登录页面
- **URL**: http://localhost:5174/admin/login
- **功能**: 管理员登录界面
- **测试账号**: 
  - 用户名: `admin`
  - 密码: `admin`

### 2. 管理员仪表板
- **URL**: http://localhost:5174/admin/dashboard
- **功能**: 管理员后台管理界面
- **访问条件**: 需要先登录

### 3. 首页导航
- **URL**: http://localhost:5174/
- **功能**: 包含"管理员登录"按钮，可直接跳转到登录页面

## 核心功能

### 🔐 认证系统
- ✅ 用户名密码登录
- ✅ JWT Token认证
- ✅ 自动token刷新
- ✅ 登录状态持久化
- ✅ 自动登录检测

### 🛡️ 安全机制
- ✅ 表单验证（用户名、密码不能为空）
- ✅ 错误信息统一处理
- ✅ 401未授权自动跳转登录
- ✅ Token过期处理
- ✅ 安全登出

### 📱 用户体验
- ✅ 响应式设计
- ✅ 加载状态提示
- ✅ 错误信息展示
- ✅ 一键测试账号
- ✅ 自动页面跳转

## 技术实现

### 1. API接口对接
```typescript
// 管理员登录API
POST /api/admin/login
{
  "username": "admin",
  "password": "admin"
}

// 响应格式
{
  "code": 200,
  "message": "操作成功",
  "data": {
    "admin": { ... },
    "token": "eyJhbGciOiJIUzI1NiJ9..."
  }
}
```

### 2. 状态管理
- **Zustand Store**: 管理员状态管理
- **LocalStorage**: Token和用户信息持久化
- **自动初始化**: 页面刷新后自动恢复登录状态

### 3. 路由保护
- **登录检测**: 访问仪表板时自动检查登录状态
- **自动跳转**: 未登录时跳转到登录页面
- **登录后跳转**: 登录成功后跳转到仪表板

### 4. HTTP拦截器集成
- **自动Token**: 请求时自动添加管理员Token
- **优先级**: 管理员Token优先于普通用户Token
- **错误处理**: 统一的错误响应处理

## 测试步骤

### 1. 基本登录测试
1. 访问 http://localhost:5174/
2. 点击"管理员登录"按钮
3. 输入测试账号（admin/admin）或点击"使用测试账号"
4. 点击"登录"按钮
5. 验证是否跳转到仪表板页面

### 2. 状态持久化测试
1. 完成登录后刷新页面
2. 验证是否仍然保持登录状态
3. 直接访问 `/admin/dashboard` 验证自动登录

### 3. 登出功能测试
1. 在仪表板页面点击"登出"按钮
2. 验证是否跳转到登录页面
3. 验证登录状态是否已清除

### 4. 权限验证测试
1. 未登录状态下直接访问 `/admin/dashboard`
2. 验证是否自动跳转到登录页面

### 5. 错误处理测试
1. 输入错误的用户名或密码
2. 验证错误信息是否正确显示
3. 测试网络错误情况（如后端未启动）

## 文件结构

```
src/
├── types/
│   └── admin.ts              # 管理员类型定义
├── lib/
│   ├── http.ts               # HTTP拦截器（已更新支持管理员Token）
│   └── api/
│       └── admin-api.ts      # 管理员API服务
├── hooks/
│   └── api/
│       └── use-admin-api.ts  # 管理员API钩子
├── store/
│   └── admin-store.ts        # 管理员状态管理
├── pages/
│   ├── AdminLogin.tsx        # 管理员登录页面
│   └── AdminDashboard.tsx    # 管理员仪表板
└── routes/
    └── routes.tsx            # 路由配置（已添加管理员路由）
```

## API接口规范

### 请求格式
- **Content-Type**: application/json
- **请求方法**: POST
- **接口路径**: /api/admin/login

### 响应格式
遵循项目统一的API响应格式：
```json
{
  "code": 200,
  "message": "操作成功",
  "data": {
    "admin": {
      "id": 1,
      "username": "admin",
      "email": "admin@example.com",
      "role": "ADMIN",
      "createTime": "2025-08-11T10:30:00",
      "updateTime": "2025-08-11T10:30:00"
    },
    "token": "eyJhbGciOiJIUzI1NiJ9..."
  },
  "timestamp": "2025-09-11T23:00:00"
}
```

## 注意事项

1. **后端依赖**: 需要后端API服务运行在 `http://localhost:8080`
2. **Token有效期**: JWT Token有效期为24小时
3. **浏览器兼容**: 支持现代浏览器的localStorage功能
4. **安全考虑**: Token存储在localStorage中，生产环境建议使用更安全的存储方式

## 扩展功能

可以基于当前实现继续扩展：

1. **权限管理**: 基于角色的权限控制
2. **多级管理员**: 支持不同级别的管理员
3. **操作日志**: 记录管理员操作历史
4. **密码修改**: 管理员密码修改功能
5. **会话管理**: 多设备登录管理

## 故障排除

### 常见问题

1. **登录失败**: 检查后端API是否正常运行
2. **Token过期**: 重新登录获取新Token
3. **页面跳转异常**: 检查路由配置是否正确
4. **状态丢失**: 检查localStorage是否被清除

### 调试方法

1. 打开浏览器开发者工具
2. 查看Network标签页的API请求
3. 查看Console标签页的错误信息
4. 查看Application标签页的localStorage存储